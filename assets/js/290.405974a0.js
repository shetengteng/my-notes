(window.webpackJsonp=window.webpackJsonp||[]).push([[290],{1121:function(s,a,n){"use strict";n.r(a);var t=n(15),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("blockquote",[n("p",[s._v("如果需要根据变量、facts或此前任务的执行结果来做为某task执行与否的前提时使用when实现\n在task中用于条件测试，并支持jinja2的语法格式")])]),s._v(" "),n("p",[s._v("语法")]),s._v(" "),n("ul",[n("li",[s._v("在task后添加when子句即可使用条件测试；when语句支持Jinja2表达式语法")])]),s._v(" "),n("p",[s._v("简单示例：当系统属于红帽系列，执行")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("tasks:\n  - name: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shutdown RedHat flavored systems"')]),s._v("\n    command: /sbin/shutdown -h now\n    when: ansible_os_family "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RedHat"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v('when语句中还可以使用Jinja2的大多"filter"，如要忽略此前某语句的错误并基于其结果(failed或者success)运行后面指定的语句')]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("tasks:\n  - command: /bin/false\n    register: result\n    ignore_errors: True\n  - command: /bin/something\n    when: result"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("failed\n  - command: /bin/something_else\n    when: result"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("success\n  - command: /bin/still/something_else\n    when: result"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("skipped\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("when语句中可以使用facts或playbook中定义的变量")]),s._v(" "),n("h2",{attrs:{id:"应用实例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应用实例"}},[s._v("#")]),s._v(" 应用实例")]),s._v(" "),n("p",[s._v("不同的系统版本使用不同的操作")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("- hosts: websrvs\n  remote_user: root\n  tasks:\n    - name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" group nginx\n      tags: user\n      user: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("present\n    - name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" user nginx\n      user: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("present "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n    - name: Install Nginx\n      yum: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("present\n    - name: restart Nginx\n      service: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("restarted\n      when: ansible_distribution_major_version "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("不同的系统版本使用不同的配置文件")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("tasks:\n  - name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" conf "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" to centos7\n    template: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx.conf.c7.j2 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/nginx/nginx.conf\n    when: ansible_distribution_major_version "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7"')]),s._v("\n  - name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" conf "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" to centos6\n    template: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx.conf.c6.j2 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/nginx/nginx.conf\n    when: ansible_distribution_major_version "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);