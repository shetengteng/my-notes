(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{1096:function(t,s,a){"use strict";a.r(s);var r=a(15),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,r=t._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h2",{attrs:{id:"计算公式"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#计算公式"}},[t._v("#")]),t._v(" 计算公式")]),t._v(" "),r("blockquote",[r("p",[t._v("当索引一个文档的时候，文档会被存储到一个主分片中。 Elasticsearch 如何知道一个文档应该存放到哪个分片中呢？当创建文档时，它如何决定这个文档应当被存储在分片 1 还是分片 2 中呢？")])]),t._v(" "),r("p",[r("img",{attrs:{src:a(690),alt:""}})]),t._v(" "),r("p",[t._v("这个过程是根据下面这个公式决定的：")]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[t._v("shard "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hash"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("routing"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" % number_of_primary_shards\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br")])]),r("p",[t._v("routing 是一个可变值，默认是文档的 _id，可设置成一个自定义的值\nrouting 通过hash 函数生成一个数字，然后这个数字再除以 number_of_primary_shards （主分片的数量）后得到余数 。这个分布在 0 到 number_of_primary_shards-1 之间的余数，就是文档所在分片的位置")]),t._v(" "),r("p",[t._v("所有的文档API ( get , index, delete, bulk , update，mget ）都接受一个叫做routing 的路由参数，通过这个参数可以自定义文档到分片的映射；一个自定义的路由参数可用来确保所有相关的文档（如所有属于同一个用户的文档）都被存储到同一个分片中")]),t._v(" "),r("p",[r("strong",[t._v("为什么创建索引时确定好主分片的数量并且不能改变主分片数量？")])]),t._v(" "),r("p",[t._v("如果数量变化了，那么所有之前路由的值都会无效，文档也再也找不到了")])])}),[],!1,null,null,null);s.default=e.exports},690:function(t,s,a){t.exports=a.p+"assets/img/routing.976f59b7.png"}}]);