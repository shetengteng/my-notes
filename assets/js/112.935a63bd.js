(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{1143:function(s,a,t){"use strict";t.r(a);var n=t(15),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("playbook采用YAML语言编写")]),s._v(" "),n("p",[s._v('playbook是由一个或多个"play"组成的列表')]),s._v(" "),n("ul",[n("li",[s._v("play的主要功能在于将预定义的一组主机，装扮成事先通过ansible中的task定义好的角色")]),s._v(" "),n("li",[s._v("Task实际是调用ansible的一个module，将多个play组织在一个playbook中，即可以让它们联合起来，按事先编排的机制执行预定义的动作")])]),s._v(" "),n("p",[s._v("流程")]),s._v(" "),n("ul",[n("li",[s._v("用户通过ansible命令直接调用yml语言写好的playbook")]),s._v(" "),n("li",[s._v("playbook由多条play组成")]),s._v(" "),n("li",[s._v("每条play都有"),n("strong",[s._v("一个任务")]),s._v(" task 相对应的操作，调用模块modules")]),s._v(" "),n("li",[s._v("应用在主机清单上,通过ssh远程连接，从而控制远程主机或者网络设备")])]),s._v(" "),n("img",{staticStyle:{zoom:"80%"},attrs:{src:t(935)}}),s._v(" "),n("h2",{attrs:{id:"简单上手示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简单上手示例"}},[s._v("#")]),s._v(" 简单上手示例")]),s._v(" "),n("p",[s._v("编写一个playbook的yaml文件，hello.yml")]),s._v(" "),n("ul",[n("li",[s._v("使用command模块执行hostname命令")]),s._v(" "),n("li",[s._v("在主机清单的group为websrvs的所有主机中，使用root用户执行")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可忽略 ---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" websrvs\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" hello\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" hostname\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("执行该yaml文件")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux101 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook hello.yml ")]),s._v("\n\nPLAY "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("websrvs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" **********************\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Gathering Facts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *****ok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.103"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.102"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.104"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("hello"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ***********changed: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.102"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nchanged: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.103"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nchanged: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.104"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nPLAY RECAP *****************************************\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.102  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ok")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("changed")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unreachable")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("failed")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("skipped")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rescued")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ignored")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.103  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ok")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("changed")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unreachable")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("failed")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("skipped")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rescued")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ignored")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.104  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ok")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("changed")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unreachable")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("failed")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("skipped")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rescued")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ignored")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"关于加密"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关于加密"}},[s._v("#")]),s._v(" 关于加密")]),s._v(" "),n("p",[s._v("由于playbook中可能会包含敏感信息，需要进行加密操作，使用ansible-vault命令进行加密操作")]),s._v(" "),n("p",[s._v("示例：对之前的hello.yml进行加密")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux101 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-vault encrypt hello.yml ")]),s._v("\nNew Vault password: \nConfirm New Vault password: \nEncryption successful\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("查看加密后的文件")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux101 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat hello.yml ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ANSIBLE_VAULT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("AES256\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("61323234643433366430356264396131333935343862306334626265653630323737333634366338")]),s._v("\n3737363965616264646461356537366237643936356232390a373137623862386165306430333035\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("34646638626333383335323762313865373335663133643163623738306561313430363863653138")]),s._v("\n3039633234633435360a333135633030343539336438376433646232613832323637323238316165\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("37366430626439626363653938363162356465613462633139333339643838353461383132373266")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("33663963303233343438373930356134626530616531636465323634393263663466663532656465")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("61653631373764333731666665353931626135663263633262386633393865313039326439643661")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("36323635363737363034643465316338663966376663313336376336303232363961393937626239")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("33313566313637616266636562643636356639333934353533343032396530623033363566313133")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3638363830653431396638366632376661323137663365636539")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("此时直接运行会报错")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux101 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook hello.yml")]),s._v("\nERROR"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Attempting to decrypt but no vault secrets found\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("如果要运行hello.yml需要进行解密操作")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux101 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-vault decrypt hello.yml ")]),s._v("\nVault password: \nDecryption successful\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux101 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat hello.yml ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可忽略 ---")]),s._v("\n---\n- hosts: websrvs\n  remote_user: root\n     \n  tasks:\n    - name: hello\n      command: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("还可以不解密的情况下查看加密的文件以及重置key的操作，详细命令查看"),n("code",[s._v("基础命令")]),s._v("一节中的ansible-vault操作")])])}),[],!1,null,null,null);a.default=e.exports},935:function(s,a,t){s.exports=t.p+"assets/img/playbook.6c79c000.png"}}]);