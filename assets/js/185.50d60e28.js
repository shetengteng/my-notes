(window.webpackJsonp=window.webpackJsonp||[]).push([[185],{1117:function(t,s,r){"use strict";r.r(s);var a=r(15),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,r=t._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("p",[t._v("当我们查询文档的时候， Elasticsearch 如何知道一个文档应该存放到哪个分片中呢？它其实是通过下面这个公式来计算出")]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[t._v("shard "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hash"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("routing"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" % number_of_primary_shards\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br")])]),r("p",[t._v("routing 默认值是文档的 id，也可以采用自定义值，比如用户 id")]),t._v(" "),r("h2",{attrs:{id:"不带routing查询"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#不带routing查询"}},[t._v("#")]),t._v(" 不带routing查询")]),t._v(" "),r("p",[t._v("在查询的时候因为不知道要查询的数据具体在哪个分片上，所以整个过程分为2个步骤")]),t._v(" "),r("ul",[r("li",[t._v("分发：请求到达协调节点后，协调节点将查询请求分发到每个分片上。")]),t._v(" "),r("li",[t._v("聚合：协调节点搜集到每个分片上查询结果，在将查询的结果进行排序，之后给用户返回结果")])]),t._v(" "),r("h2",{attrs:{id:"带routing查询"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#带routing查询"}},[t._v("#")]),t._v(" 带routing查询")]),t._v(" "),r("p",[t._v("查询的时候，可直接根据routing 信息定位到某个分配查询，不需要查询所有的分配，经过协调节点排序；上面自定义的用户查询，如果routing 设置为userid 的话，就可以直接查询出数据来，效率提升很多")])])}),[],!1,null,null,null);s.default=n.exports}}]);