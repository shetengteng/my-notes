(window.webpackJsonp=window.webpackJsonp||[]).push([[279],{1144:function(s,a,t){"use strict";t.r(a);var n=t(15),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"文件目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件目录"}},[s._v("#")]),s._v(" 文件目录")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("/etc/ansible/ansible.cfg  主配置文件,配置ansible工作特性"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("一般无需修改"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/etc/ansible/hosts        主机清单"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("将被管理的主机放到此文件"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/etc/ansible/roles/       存放角色的目录 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认路径，可以修改")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"程序文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#程序文件"}},[s._v("#")]),s._v(" 程序文件")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("/usr/bin/ansible          主程序，临时命令执行工具\n/usr/bin/ansible-doc      查看配置文档，模块功能查看工具 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1000+的模块的使用说明")]),s._v("\n/usr/bin/ansible-galaxy   下载/上传优秀代码或Roles模块的官网平台\n/usr/bin/ansible-playbook 定制自动化任务，编排剧本工具\n/usr/bin/ansible-pull     远程执行命令的工具\n/usr/bin/ansible-vault    文件加密工具\n/usr/bin/ansible-console  基于Console界面与用户交互的执行工具\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"主机清单-inventory"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主机清单-inventory"}},[s._v("#")]),s._v(" 主机清单 Inventory")]),s._v(" "),t("blockquote",[t("p",[s._v("ansible的主要功用在于批量主机操作，为了便捷地使用其中的部分主机，可在inventory file中将其分组命名")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("默认的inventory file为/etc/ansible/hosts")])]),s._v(" "),t("li",[t("p",[s._v("inventory file可以有多个，且也可以通过Dynamic Inventory来动态生成")])]),s._v(" "),t("li",[t("p",[s._v("/etc/ansible/hosts文件格式")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("inventory文件遵循INI文件风格，中括号中的字符为组名")])]),s._v(" "),t("li",[t("p",[s._v("可将同一个主机同时归并到多个不同的组中")])]),s._v(" "),t("li",[t("p",[s._v("若目标主机使用了非默认的SSH端口，可在主机名称之后使用冒号加端口号来标明")])])])])]),s._v(" "),t("h3",{attrs:{id:"常规配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常规配置"}},[s._v("#")]),s._v(" 常规配置")]),s._v(" "),t("p",[s._v("示例")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ntp.stt.com   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不分组,直接加")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.102\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.103\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.104\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"分组配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分组配置"}},[s._v("#")]),s._v(" 分组配置")]),s._v(" "),t("p",[s._v("如果主机名称遵循相似的命名模式，可使用列表的方式标识各主机，示例")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webservers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#webservers组")]),s._v("\nwww1.stt.com:2222  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以指定端口")]),s._v("\nwww2.stt.com\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dbservers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndb1.stt.com\ndb2.stt.com\ndb3.stt.com\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("websrvs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示102-104范围内的ip")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dbsrvs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndb-"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("a:f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".example.com  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示范围dba-dbf")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h3",{attrs:{id:"组嵌套"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#组嵌套"}},[s._v("#")]),s._v(" 组嵌套")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhttpd1.stt.com\nhttpd2.stt.com\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nngx1.stt.com\nngx2.stt.com\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("websrvs:children"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将上面2个组进行组合")]),s._v("\napache\nnginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参数"}},[s._v("#")]),s._v(" 参数")]),s._v(" "),t("p",[s._v("用于定义ansible远程连接目标主机时使用的参数，而非传递给playbook的变量；ansible基于ssh连接inventory中指定的远程主机时，可以通过参数指定其交互方式")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("ansible_ssh_host")]),s._v(" "),t("ul",[t("li",[s._v("The name of the host to connect to, if different from the alias you wishto give to it.")])])]),s._v(" "),t("li",[t("p",[s._v("ansible_ssh_port")]),s._v(" "),t("ul",[t("li",[s._v("The ssh port number, if not 22")])])]),s._v(" "),t("li",[t("p",[s._v("ansible_ssh_user")]),s._v(" "),t("ul",[t("li",[s._v("The default ssh user name to use.")])])]),s._v(" "),t("li",[t("p",[s._v("ansible_ssh_pass")]),s._v(" "),t("ul",[t("li",[s._v("The ssh password to use (this is insecure, we strongly recommendusing --ask-pass or SSH keys)")])])]),s._v(" "),t("li",[t("p",[s._v("ansbile_sudo_pass")]),s._v(" "),t("ul",[t("li",[s._v("The sudo password to use (this is insecure, we strongly recommendusing --ask-sudo-pass)")])])]),s._v(" "),t("li",[t("p",[s._v("ansible_connection")]),s._v(" "),t("ul",[t("li",[s._v("Connection type of the host. Candidates are local, ssh or paramiko.The default is paramiko before Ansible 1.2, and 'smart' afterwards which detects whether usage of 'ssh' would be feasible based on whether ControlPersist is supported")])])]),s._v(" "),t("li",[t("p",[s._v("ansible_ssh_private_key_file")]),s._v(" "),t("ul",[t("li",[s._v("Private key file used by ssh. Useful if using multiple keys and you don't want to use SSH agent.")])])]),s._v(" "),t("li",[t("p",[s._v("ansible_shell_type")]),s._v(" "),t("ul",[t("li",[s._v("The shell type of the target system. By default commands are formatted using 'sh'-style syntax by default. Setting this to 'csh' or 'fish' will cause commands executed on target systems to follow those shell's syntax instead.")])])]),s._v(" "),t("li",[t("p",[s._v("ansible_python_interpreter")]),s._v(" "),t("ul",[t("li",[s._v('The target host python path. This is useful for systems with more than one Python or not located at "/usr/bin/python" such as *BSD, or where /usr/bin/python is not a 2.X series Python. We do not use the "/usr/bin/env" mechanism as that requires the remote user\'s path to be set right and also assumes the "python" executable is named python,where the executable might be named something like "python26"')])])]),s._v(" "),t("li",[t("p",[s._v("ansible_*_interpreter")]),s._v(" "),t("ul",[t("li",[s._v("Works for anything such as ruby or perl and works just like ansible_python_interpreter.This replaces shebang of modules which will run on that host.")])])])]),s._v(" "),t("p",[s._v("示例")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("websrvs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_pass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_pass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),t("blockquote",[t("p",[s._v("路径：/etc/ansible/ansible.cfg\n一般保持默认配置")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/ansible/ansible.cfg\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("defaults默认配置")]),s._v(" "),t("ul",[t("li",[s._v("ansible在执行命令时，会将命令转换为python脚本生成在本地local_tmp，然后传递到远程服务器的临时目录remote_tmp")]),s._v(" "),t("li",[s._v("命令执行完成后，删除对应的python命令文件")]),s._v(" "),t("li",[s._v("forks 表示并发执行的次数，同时可以给5台机器发送指令")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("defaults"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#inventory     = /etc/ansible/hosts      # 主机列表配置文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#library       = /usr/share/my_modules/  # 库文件存放目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#remote_tmp    = $HOME/.ansible/tmp      # 临时py命令文件存放在远程主机目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#local_tmp     = $HOME/.ansible/tmp      # 本机的临时命令执行目录  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#forks         = 5                       # 默认并发数,同时可以执行5次")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sudo_user     = root                    # 默认sudo用户")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ask_sudo_pass = True                    # 每次执行ansible命令是否询问ssh密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ask_pass      = True                    # 每次执行ansible命令是否询问ssh口令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#remote_port   = 22                      # 远程主机的端口号(默认22)")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("建议优化项")]),s._v(" "),t("ul",[t("li",[s._v("host_key_checking 如果开启，每次需要在"),t("code",[s._v("known_host")]),s._v("中先与其他主机建立一下链接的询问")]),s._v(" "),t("li",[s._v("默认情况下 ansible是不记录日志的，需要开启日志配置")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("host_key_checking "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" False               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查对应服务器的host_key，建议取消注释")]),s._v("\nlog_path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/log/ansible.log         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志文件,建议取消注释")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认模块设置，目前默认模块使用command ，即 ansible all -m command -a xxx 等同于 ansible all -a xxx")]),s._v("\nmodule_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);