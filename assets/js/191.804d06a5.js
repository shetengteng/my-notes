(window.webpackJsonp=window.webpackJsonp||[]).push([[191],{1153:function(_,v,t){"use strict";t.r(v);var e=t(15),l=Object(e.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h2",{attrs:{id:"可能的成因"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#可能的成因"}},[_._v("#")]),_._v(" 可能的成因")]),_._v(" "),t("p",[_._v("网络问题")]),_._v(" "),t("ul",[t("li",[_._v("集群间的网络延迟导致一些节点访问不到master, 认为master 挂掉了从而选举出新的master,并对master上的分片和副本标红，分配新的主分片")])]),_._v(" "),t("p",[_._v("节点负载")]),_._v(" "),t("ul",[t("li",[_._v("主节点的角色既为master又为data")]),_._v(" "),t("li",[_._v("访问量较大时可能会导致ES停止响应造成大面积延迟")]),_._v(" "),t("li",[_._v("此时其他节点得不到主节点的响应认为主节点挂掉了，会重新选取主节点")])]),_._v(" "),t("p",[_._v("内存回收")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("主节点的角色既为master又为data")])]),_._v(" "),t("li",[t("p",[_._v("data 节点上的ES进程占用的内存较大，引发JVM的大规模内存回收，造成ES进程失去响应")])])]),_._v(" "),t("h2",{attrs:{id:"解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[_._v("#")]),_._v(" 解决方案")]),_._v(" "),t("p",[_._v("减少误判")]),_._v(" "),t("ul",[t("li",[t("code",[_._v("discovery.zen ping_timeout")]),_._v(" 节点状态的响应时间\n"),t("ul",[t("li",[_._v("默认为3s，如果master在该响应时间的范围内没有做出响应应答，判断该节点已经挂掉了")]),_._v(" "),t("li",[_._v("调大参数，可适当减少误判\n"),t("ul",[t("li",[_._v("如6s，"),t("code",[_._v("discovery.zen.ping_timeout")]),_._v(":6")])])])])])]),_._v(" "),t("p",[_._v("选举触发")]),_._v(" "),t("ul",[t("li",[t("code",[_._v("discovery.zen.minimum._master_nodes")]),_._v(":1\n"),t("ul",[t("li",[_._v("该参数是用于控制选举行为发生的"),t("strong",[_._v("最小集群主节点数量")])]),_._v(" "),t("li",[_._v("当备选主节点的个数大于等于该参数的值，且备选主节点中有该参数个节点认为主节点挂了，进行选举")]),_._v(" "),t("li",[_._v("建议为(n / 2) +1, n为主节点个数，即有资格成为主节点的节点个数")])])])]),_._v(" "),t("p",[_._v("角色分离")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("即master节点与data节点分离，限制角色")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("主节点配置为")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("node master: true")])]),_._v(" "),t("li",[t("p",[_._v("node data: false")])])])]),_._v(" "),t("li",[t("p",[_._v("从节点配置为")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("node master: false")])]),_._v(" "),t("li",[t("p",[_._v("node data: true")])])])])])])])])}),[],!1,null,null,null);v.default=l.exports}}]);