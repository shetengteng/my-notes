(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{1102:function(t,s,e){"use strict";e.r(s);var o=e(15),a=Object(o.a)({},(function(){var t=this,s=t.$createElement,o=t._self._c||s;return o("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[o("p",[t._v("部分更新一个文档结合了先前说明的读取和写入流程")]),t._v(" "),o("p",[o("img",{attrs:{src:e(697),alt:""}})]),t._v(" "),o("h2",{attrs:{id:"步骤"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#步骤"}},[t._v("#")]),t._v(" 步骤")]),t._v(" "),o("ul",[o("li",[t._v("客户端向 Node 1 发送更新请求")]),t._v(" "),o("li",[t._v("它将请求转发到主分片所在的 Node 3")]),t._v(" "),o("li",[t._v("Node 3 从主分片检索文档，修改 _source 字段中的 JSON ，并且尝试重新索引主分片的文档。 如果文档已经被另一个进程修改，它会重试此步骤，超过 retry_on_conflict 次后放弃")]),t._v(" "),o("li",[t._v("如果 Node 3 成功地更新文档，它将新版本的文档并行转发到 Node 1 和 Node 2 上的副本分片，"),o("strong",[t._v("重新建立索引")]),t._v("。一旦所有副本分片都返回成功， Node 3 向协调节点也返回成功，协调节点向客户端返回成功\n"),o("ul",[o("li",[t._v("主分片节点会记录所有副分片节点的信息")])])])]),t._v(" "),o("div",{staticClass:"custom-block warning"},[o("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),o("p",[t._v("当主分片把更改转发到副本分片时， 它不会转发更新请求。 相反，它"),o("strong",[t._v("转发完整文档")]),t._v("的新版本。这些更改将会"),o("strong",[t._v("异步")]),t._v("转发到副本分片，并且不能保证它们以发送它们相同的顺序到达。 如果 Elasticsearch 仅转发更改请求，则可能以错误的顺序应用更改，导致得到损坏的文档")])])])}),[],!1,null,null,null);s.default=a.exports},697:function(t,s,e){t.exports=e.p+"assets/img/update-data.1fe8f61b.png"}}]);