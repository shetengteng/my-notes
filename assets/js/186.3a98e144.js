(window.webpackJsonp=window.webpackJsonp||[]).push([[186],{1119:function(e,_,v){"use strict";v.r(_);var s=v(15),r=Object(s.a)({},(function(){var e=this,_=e.$createElement,v=e._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("p",[e._v("ES 的默认配置，是综合了数据可靠性、写入速度、搜索实时性等因素。实际使用时，需要根据公司要求，进行偏向性的优化")]),e._v(" "),v("p",[e._v("针对于搜索性能要求不高，但是对写入要求较高的场景，我们需要尽可能的选择恰当写优化策略。综合来说，可以考虑以下几个方面来提升写索引的性能")]),e._v(" "),v("ul",[v("li",[e._v("加大Translog Flush，目的是降低Iops、Writeblock")]),e._v(" "),v("li",[e._v("增加Index Refesh间隔，目的是减少Segment Merge的次数")]),e._v(" "),v("li",[e._v("调整Bulk 线程池和队列")]),e._v(" "),v("li",[e._v("优化节点间的任务分布")]),e._v(" "),v("li",[e._v("优化Lucene层的索引建立，目的是降低CPU及IO")])]),e._v(" "),v("h2",{attrs:{id:"优化存储设备"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#优化存储设备"}},[e._v("#")]),e._v(" 优化存储设备")]),e._v(" "),v("p",[e._v("ES 是一种密集使用磁盘的应用，在段合并的时候会频繁操作磁盘，所以对磁盘要求较高，当磁盘速度提升之后，集群的整体性能会大幅度提高")]),e._v(" "),v("h2",{attrs:{id:"合理使用合并"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#合理使用合并"}},[e._v("#")]),e._v(" 合理使用合并")]),e._v(" "),v("p",[e._v("Lucene 以段的形式存储数据。当有新的数据写入索引时， Lucene 就会自动创建一个新的段")]),e._v(" "),v("p",[e._v("随着数据量的变化，段的数量会越来越多，消耗的多文件句柄数及 CPU 就越多，查询效率就会下降")]),e._v(" "),v("p",[e._v("由于 Lucene 段合并的计算量庞大，会消耗大量的 I/O，所以 "),v("strong",[e._v("ES 默认采用较保守的策略")]),e._v("，让后台定期进行段合并")]),e._v(" "),v("h2",{attrs:{id:"减少-refresh-的次数"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#减少-refresh-的次数"}},[e._v("#")]),e._v(" 减少 Refresh 的次数")]),e._v(" "),v("p",[e._v("Lucene 在新增数据时，采用了延迟写入的策略")]),e._v(" "),v("ul",[v("li",[e._v("默认情况下索引的refresh_interval 为1 秒")]),e._v(" "),v("li",[e._v("将待写入的数据先写到内存中，超过 1 秒（默认）时就会触发一次 Refresh，然后 Refresh 会把内存中的的数据刷新到操作系统的文件缓存系统中")])]),e._v(" "),v("p",[e._v("如果对搜索的实效性要求不高，可以将 Refresh 周期延长，例如 30 秒；可以有效地减少段刷新次数，但需要消耗更多的 Heap 内存")]),e._v(" "),v("h2",{attrs:{id:"加大-flush-设置"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#加大-flush-设置"}},[e._v("#")]),e._v(" 加大 Flush 设置")]),e._v(" "),v("p",[e._v("Flush 的主要目的是把文件缓存系统中的段持久化到硬盘，当 Translog 的数据量达到 512MB 或者 30 分钟时，会触发一次 Flush。")]),e._v(" "),v("p",[e._v("index.translog.flush_threshold_size 参数的默认值是 512MB，进行修改")]),e._v(" "),v("ul",[v("li",[e._v("增加参数值\n"),v("ul",[v("li",[e._v("文件缓存系统中可能需要存储更多的数据")]),e._v(" "),v("li",[e._v("需要为操作系统的文件缓存系统留下足够的空间")])])])]),e._v(" "),v("h2",{attrs:{id:"减少副本的数量"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#减少副本的数量"}},[e._v("#")]),e._v(" 减少副本的数量")]),e._v(" "),v("p",[e._v("ES 为了保证集群的可用性，提供了 Replicas（副本）支持，然而每个副本也会执行分析、索引及可能的合并过程，所以 Replicas 的数量会严重影响写索引的效率")]),e._v(" "),v("p",[e._v("当写索引时，需要把写入的数据都同步到副本节点，"),v("strong",[e._v("副本节点越多，写索引的效率就越慢")])]),e._v(" "),v("p",[e._v("如果需要大批量进行写入操作，可以先禁止Replica复制，设置")]),e._v(" "),v("ul",[v("li",[e._v("index.number_of_replicas: 0 关闭副本")]),e._v(" "),v("li",[e._v("在写入完成后， Replica 修改回正常的状态")])])])}),[],!1,null,null,null);_.default=r.exports}}]);